<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>CarConnect - Early Access Signup | Join the Waitlist</title>
    <meta name="title" content="CarConnect - Early Access Signup | Join the Waitlist">
    <meta name="description" content="Join the CarConnect waitlist for early access to our guided platform for young drivers' first car experience. Launching September 1st.">
    <meta name="keywords" content="carconnect signup, early access, waitlist, young drivers, first car">
    <meta name="author" content="CarConnect">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://carconnect.com/signup-survey">
    <meta property="og:title" content="CarConnect - Early Access Signup">
    <meta property="og:description" content="Join the CarConnect waitlist for early access to our guided platform for young drivers' first car experience.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://carconnect.com/signup-survey">
    <meta property="twitter:title" content="CarConnect - Early Access Signup">
    <meta property="twitter:description" content="Join the CarConnect waitlist for early access to our guided platform for young drivers' first car experience.">
    <meta property="twitter:image" content="https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#b2d0e5">
    <meta name="msapplication-TileColor" content="#b2d0e5">
    <meta name="application-name" content="CarConnect">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://carconnect.com/signup-survey">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    
    <!-- Fonts -->
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Common Styles -->
    <link rel="stylesheet" href="CommonCSS/styles.css">
    
    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="relative flex size-full min-h-screen flex-col bg-white justify-between group/design-root overflow-x-hidden mobile-safe-area">
        <div>
            <!-- Header Component -->
            <div id="header"></div>

            <!-- Signup Survey Section -->
            <div class="flex flex-col gap-8 px-4 py-10 @container">
                <div class="flex flex-col gap-4 text-center max-w-[600px] mx-auto">
                    <h1 class="text-[#121516] tracking-light text-[32px] font-bold leading-tight @[480px]:text-4xl @[480px]:font-black @[480px]:leading-tight @[480px]:tracking-[-0.033em]">
                        Grab the Spot
                    </h1>
                    <p class="text-[#121516] text-lg font-normal leading-normal">
                        Launching on September 1st. Limited spots available for early access.
                    </p>
                </div>

                <!-- Survey Form -->
                <div class="max-w-[600px] mx-auto w-full">
                    <form id="signup-form" class="flex flex-col gap-6">
                        <!-- Contact Information -->
                        <div class="flex flex-col gap-4">
                            <h2 class="text-[#121516] text-xl font-bold leading-tight">Tell us how you'd like to be contacted</h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="first-name" class="block text-[#121516] text-sm font-medium mb-2">First Name *</label>
                                    <input type="text" id="first-name" name="first-name" required 
                                           class="w-full px-4 py-3 border border-[#dde1e3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b2d0e5] focus:border-transparent">
                                </div>
                                <div>
                                    <label for="last-name" class="block text-[#121516] text-sm font-medium mb-2">Last Name *</label>
                                    <input type="text" id="last-name" name="last-name" required 
                                           class="w-full px-4 py-3 border border-[#dde1e3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b2d0e5] focus:border-transparent">
                                </div>
                            </div>
                            
                            <div>
                                <label for="email" class="block text-[#121516] text-sm font-medium mb-2">Email Address *</label>
                                <input type="email" id="email" name="email" required 
                                       class="w-full px-4 py-3 border border-[#dde1e3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b2d0e5] focus:border-transparent">
                            </div>
                            
                            <div>
                                <label for="phone" class="block text-[#121516] text-sm font-medium mb-2">Phone Number</label>
                                <input type="tel" id="phone" name="phone" 
                                       class="w-full px-4 py-3 border border-[#dde1e3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b2d0e5] focus:border-transparent">
                            </div>
                        </div>

                        <!-- Role Selection -->
                        <div class="flex flex-col gap-4">
                            <h2 class="text-[#121516] text-xl font-bold leading-tight">I am a... *</h2>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="young-driver" class="mr-3" required>
                                    <span class="text-[#121516] text-base">Young driver looking for my first car</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="role" value="parent" class="mr-3">
                                    <span class="text-[#121516] text-base">Parent helping my child get their first car</span>
                                </label>
                            </div>
                        </div>

                        <!-- Timeline -->
                        <div class="flex flex-col gap-4">
                            <h2 class="text-[#121516] text-xl font-bold leading-tight">When do you plan to get a car? *</h2>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="radio" name="timeline" value="within-3-months" class="mr-3" required>
                                    <span class="text-[#121516] text-base">Within 3 months</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timeline" value="3-6-months" class="mr-3">
                                    <span class="text-[#121516] text-base">3-6 months</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timeline" value="6-12-months" class="mr-3">
                                    <span class="text-[#121516] text-base">6-12 months</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="timeline" value="just-exploring" class="mr-3">
                                    <span class="text-[#121516] text-base">Just exploring options</span>
                                </label>
                            </div>
                        </div>

                        <!-- What Are You Looking For (Dynamic) -->
                        <div class="flex flex-col gap-4">
                            <h2 class="text-[#121516] text-xl font-bold leading-tight">What are you looking for? (Select all that apply) *</h2>
                            <div id="looking-for-options" class="space-y-3">
                                <!-- Options will be populated by JavaScript based on role selection -->
                                <p class="text-[#6a7781] text-sm italic">Please select your role above to see relevant options</p>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex flex-col gap-4 pt-4">
                            <button type="submit" 
                                    class="mobile-touch-target flex min-w-[84px] max-w-[280px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 px-6 bg-[#b2d0e5] text-[#121516] text-base font-bold leading-normal tracking-[0.015em] mx-auto">
                                <span class="truncate">Submit</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <!-- Footer Component -->
        <div id="footer"></div>
    </div>

    <!-- Component Loader -->
    <script src="JS/components.js"></script>
    
    <!-- Form Handling Script -->
    <script>
        // Initialize Supabase client
        // Replace these with your actual Supabase credentials
        const SUPABASE_URL = 'https://qorqpjgaupzwqojqwaur.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvcnFwamdhdXB6d3FvanF3YXVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNTU2MzAsImV4cCI6MjA2OTczMTYzMH0.EicNX9hGTagtInd4GTeBqf-vLOzwYtCO3uTCgCu3hOc';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Supabase Edge Function configuration for email sending
        const EMAIL_FUNCTION_URL = 'https://qorqpjgaupzwqojqwaur.supabase.co/functions/v1/send-email'
        
        // Function to send confirmation email via Supabase Edge Function
        async function sendConfirmationEmail(leadData) {
            try {
                // Create HTML email content
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="utf-8">
                        <title>Welcome to CarConnect!</title>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                            .header { background-color: #b2d0e5; padding: 20px; text-align: center; }
                            .content { padding: 20px; }
                            .details { background-color: #f9f9f9; padding: 15px; margin: 20px 0; border-radius: 5px; }
                            .footer { text-align: center; padding: 20px; color: #666; }
                            .highlight { background-color: #fff3cd; padding: 10px; border-radius: 5px; margin: 15px 0; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <div class="header">
                                <h1>Welcome to CarConnect! ðŸš—</h1>
                            </div>
                            <div class="content">
                                <p>Dear ${leadData.first_name},</p>
                                
                                <p>Thank you for joining the CarConnect waitlist! We're excited to have you on board for our September 1st launch.</p>
                                
                                <div class="highlight">
                                    <strong>ðŸŽ‰ You're on the list!</strong><br>
                                    We'll notify you as soon as early access becomes available.
                                </div>
                                
                                <div class="details">
                                    <h3>Your Registration Details:</h3>
                                    <ul>
                                        <li><strong>Name:</strong> ${leadData.first_name} ${leadData.last_name}</li>
                                        <li><strong>Email:</strong> ${leadData.email}</li>
                                        <li><strong>Phone:</strong> ${leadData.phone || 'Not provided'}</li>
                                        <li><strong>Role:</strong> ${leadData.role === 'young-driver' ? 'Young Driver' : 'Parent'}</li>
                                        <li><strong>Timeline:</strong> ${leadData.timeline.replace('-', ' ').replace(/(\b\w)/g, l => l.toUpperCase())}</li>
                                        <li><strong>Looking for:</strong> ${leadData.looking_for.join(', ')}</li>
                                        ${leadData.other_specify ? `<li><strong>Additional:</strong> ${leadData.other_specify}</li>` : ''}
                                    </ul>
                                </div>
                                
                                <p><strong>What's next?</strong></p>
                                <ul>
                                    <li>We'll send you updates as we get closer to launch</li>
                                    <li>You'll be among the first to know when early access opens</li>
                                    <li>We'll share exclusive content and tips for your car journey</li>
                                </ul>
                                
                                <p>If you have any questions, feel free to reply to this email.</p>
                            </div>
                            <div class="footer">
                                <p>Best regards,<br>The CarConnect Team</p>
                                <p><small>Launching September 1st, 2024</small></p>
                            </div>
                        </div>
                    </body>
                    </html>
                `

                console.log('Sending confirmation email via Supabase Edge Function...')

                // Send email using Supabase Edge Function
                const response = await fetch(EMAIL_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    },
                    body: JSON.stringify({
                        to_email: leadData.email,
                        subject: 'Welcome to CarConnect! ðŸš— You\'re on the list!',
                        html_content: htmlContent,
                    })
                })

                console.log('Edge Function response status:', response.status)

                if (!response.ok) {
                    const errorData = await response.json()
                    console.error('Edge Function error:', errorData)
                    throw new Error(`Email sending failed: ${errorData.details || errorData.error || response.statusText}`)
                }

                const result = await response.json()
                console.log('Confirmation email sent successfully via Edge Function:', result)
                return { success: true, data: result }

            } catch (error) {
                console.error('Email sending failed:', error)
                throw error
            }
        }
        
        // Dynamic options for "What are you looking for?" based on role selection
        const roleInputs = document.querySelectorAll('input[name="role"]');
        const lookingForOptions = document.getElementById('looking-for-options');
        
        const youngDriverOptions = [
            { value: 'guidance-prepared', text: 'Get guidance to be better prepared to handle the situation confidently' },
            { value: 'financial-skills', text: 'Learn financial skills in a real life situation' },
            { value: 'smooth-parents', text: 'Get a car easily, smoothly from my parents' },
            { value: 'curious', text: 'I\'m curious about the possibilities' },
            { value: 'other', text: 'Other' }
        ];
        
        const parentOptions = [
            { value: 'guidance-family', text: 'Get guidance to make the best choice for my family' },
            { value: 'teach-financial', text: 'Teach my child financial skills' },
            { value: 'quick-execute', text: 'Quickly execute on getting a car for my child' },
            { value: 'save-money', text: 'Save money (e.g., insurance)' },
            { value: 'curious', text: 'I\'m curious about the possibilities' },
            { value: 'other', text: 'Other' }
        ];
        
        function updateLookingForOptions(role) {
            const options = role === 'young-driver' ? youngDriverOptions : parentOptions;
            
            lookingForOptions.innerHTML = options.map(option => `
                <label class="flex items-center">
                    <input type="checkbox" name="looking-for" value="${option.value}" class="mr-3">
                    <span class="text-[#121516] text-base">${option.text}</span>
                </label>
            `).join('');
            
            // Add event listener for "Other" option to show text input
            const otherCheckbox = lookingForOptions.querySelector('input[value="other"]');
            if (otherCheckbox) {
                otherCheckbox.addEventListener('change', function() {
                    const existingTextInput = lookingForOptions.querySelector('#other-specify');
                    if (this.checked && !existingTextInput) {
                        const textInput = document.createElement('div');
                        textInput.id = 'other-specify';
                        textInput.className = 'ml-6 mt-2';
                        textInput.innerHTML = `
                            <input type="text" name="other-specify" placeholder="Please specify..." 
                                   class="w-full px-4 py-3 border border-[#dde1e3] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#b2d0e5] focus:border-transparent">
                        `;
                        this.parentElement.appendChild(textInput);
                    } else if (!this.checked && existingTextInput) {
                        existingTextInput.remove();
                    }
                });
            }
        }
        
        // Add event listeners to role radio buttons
        roleInputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.value === 'young-driver' || this.value === 'parent') {
                    updateLookingForOptions(this.value);
                }
            });
        });
        
        // Form submission with Supabase integration
        document.getElementById('signup-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            
            try {
                // Show loading state
                submitButton.innerHTML = '<span class="truncate">Submitting...</span>';
                submitButton.disabled = true;
                
                // Get form data
                const formData = new FormData(this);
                const data = Object.fromEntries(formData);
                
                // Get selected checkboxes for "looking-for"
                const lookingForCheckboxes = document.querySelectorAll('input[name="looking-for"]:checked');
                const lookingFor = Array.from(lookingForCheckboxes).map(cb => cb.value);
                
                // Get "other" specification if selected
                const otherSpecify = document.querySelector('input[name="other-specify"]')?.value || null;
                
                // Prepare data for Supabase
                const leadData = {
                    first_name: data['first-name'],
                    last_name: data['last-name'],
                    email: data.email,
                    phone: data.phone || null,
                    role: data.role,
                    timeline: data.timeline,
                    looking_for: lookingFor,
                    other_specify: otherSpecify
                };
                
                // Validate required fields
                if (!leadData.first_name || !leadData.last_name || !leadData.email || !leadData.role || !leadData.timeline || lookingFor.length === 0) {
                    throw new Error('Please fill in all required fields.');
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(leadData.email)) {
                    throw new Error('Please enter a valid email address.');
                }
                
                // Insert data into Supabase
                const { data: result, error } = await supabase
                    .from('leads')
                    .insert([leadData]);
                
                if (error) {
                    if (error.code === '23505') { // Unique constraint violation
                        throw new Error('This email address is already registered.');
                    }
                    throw new Error('Failed to submit form. Please try again.');
                }
                
                // Send confirmation email via Resend
                try {
                    await sendConfirmationEmail(leadData);
                    console.log('Confirmation email sent successfully');
                } catch (emailError) {
                    console.warn('Email sending failed:', emailError);
                    // Don't show error to user since form submission was successful
                }
                
                // Success - show success message and reset form
                alert('Thank you for grabbing your spot! We\'ll be in touch soon. Check your email for confirmation.');
                this.reset();
                
                // Reset the dynamic options
                lookingForOptions.innerHTML = '<p class="text-[#6a7781] text-sm italic">Please select your role above to see relevant options</p>';
                
            } catch (error) {
                // Show error message
                alert(error.message || 'An error occurred. Please try again.');
            } finally {
                // Reset button state
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html> 